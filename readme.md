
# 🚀 CrimeSift Backend

CrimeSift is a backend application built using Node.js and Fastify. It provides endpoints to analyze chat data from Instagram and WhatsApp using AI models. This README provides a comprehensive guide to setting up, running, and understanding the backend.

## 📚 Table of Contents

- 📥 Installation
- ⚙️ Configuration
- 🚀 [Running the Application](#running-the-application)
- 🌐 [API Endpoints](#api-endpoints)
    - 📸 [Analyze Instagram Chat](#analyze-instagram-chat)
    - 📱 [Analyze WhatsApp Chat](#analyze-whatsapp-chat)
- 🗂️ [Project Structure](#project-structure)
- 🔧 Utilities
- 📜 License
- 🌐 [Frontend Setup](#frontend-setup)
- 📝 [Project Overview](#project-overview)

## 📥 Installation

1. Clone the repository:
        ```sh
        git clone <repository-url>
        cd crimesift-backend
        ```

2. Install dependencies using pnpm:
        ```sh
        pnpm install
        ```

## ⚙️ Configuration

1. Create a `.env` file in the root directory and add your environment variables:
        ```env
        API_KEY=your_google_ai_api_key
        ```

2. Ensure the `.gitignore` file includes the following to prevent sensitive files from being committed:
        ```ignore
        node_modules
        .env
        pnpm-lock.yaml
        ```

## 🚀 Running the Application

To start the application, you can use the following npm scripts defined in the `package.json`:

- For production:
        ```sh
        pnpm start
        ```

- For development with live reloading:
        ```sh
        pnpm dev
        ```

## 🌐 API Endpoints

### 📸 Analyze Instagram Chat

- **Endpoint:** `/analyzeInstagram`
- **Method:** `POST`
- **Description:** Analyzes Instagram chat data based on a user-provided prompt.
- **Request:**
    - **Fields:**
        - `time`: Timestamp of the chat.
        - `prompt`: User prompt for analysis.
    - **File:** Chat data file.
- **Response:** JSON array with analysis results.

### 📱 Analyze WhatsApp Chat

- **Endpoint:** `/analyzeWhatsapp`
- **Method:** `POST`
- **Description:** Analyzes WhatsApp chat data based on a user-provided prompt.
- **Request:**
    - **Fields:**
        - `time`: Timestamp of the chat.
        - `prompt`: User prompt for analysis.
    - **File:** Chat data file.
- **Response:** JSON array with analysis results.

## 🗂️ Project Structure

```
.env
.gitignore
package.json
plugins/
    cors.js
    sensible.js
pnpm-lock.yaml
routes/
    analyzeInstagram.js
    analyzeWhatsapp.js
    helpers.js
server.js
utils/
    aiClient.js
    logger.js
```

- **routes/**: Contains route handlers for different endpoints.
    - `analyzeInstagram.js`: Handles Instagram chat analysis.
    - `analyzeWhatsapp.js`: Handles WhatsApp chat analysis.
- **utils/**: Contains utility modules.
    - `aiClient.js`: Manages interactions with the AI service.
    - `logger.js`: Provides logging functionality.
- **plugins/**: Contains Fastify plugins.
    - `cors.js`: Configures CORS settings.
    - `sensible.js`: Adds sensible defaults to Fastify.
- **server.js**: Entry point of the application.

## 🔧 Utilities

- **Logger**: The logger utility is used for logging information, errors, and debug messages.
    - Import: `const logger = require("../utils/logger");`
- **AI Client**: The AI client utility manages interactions with the Google Generative AI service.
    - Functions:
        - `getAIModel(systemInstruction)`: Initializes the AI model.
        - `uploadFileToAI(filePath, mimeType, displayName)`: Uploads a file to the AI service.
        - `deleteAIFile(fileName)`: Deletes a file from the AI service.

## 📜 License

This project is licensed under the MIT License. See the LICENSE file for details.

## 🌐 Frontend Setup

To set up the frontend, go to the [CrimeSift Frontend Repository](https://github.com/crimeSift-CAC-WA-1/front-end) and follow the instructions in the README.

## 📝 Project Overview

CrimeSift is an app that lets users import text chats from popular platforms like Discord, WhatsApp, Signal, Instagram, and others. It helps users search for messages related to crime using customizable prompts.

The app will have the following features:

- **Main Page**: Describes the app's functionality and includes a testimonial from one user with a photo and audio recording.
- **GitHub Page**: Links to the open-source project code.
- **Reports Page**: Stores previous reports generated by users.
- **Analyze Page**:
    - Provides step-by-step instructions for downloading chat data from Instagram, Discord, WhatsApp, etc.
    - Includes YouTube tutorials for each platform.
    - Allows users to import chats (if it's a Discord chat, they must also enter a token).
- **Flagged Messages Page**:
    - Linked from the Analyze Page.
    - Displays flagged messages in a clean markdown format.
    - Shows a visually appealing, graphic timeline of flagged events with context (before and after messages).
    - Includes a "Back" button to return to the Analyze page.
- **Username Search Page**:
    - Allows users to enter a username and search for its presence across platforms like WhatsApp and Discord.
    - Displays a dropdown with platform logos, showing a green check or red X next to each logo to indicate if the username was found.

**Data Format for Timeline**: Data for flagged messages and context will be provided in this format.